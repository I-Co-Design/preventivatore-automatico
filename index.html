<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>PREVENTIVATORE AUTOMATICO PROGETTO PROLUNGHE</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f7f7f7; }
        .container { max-width: 800px; margin: 40px auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 8px #bbb; padding: 30px; }
        h1 { text-align: center; color: #003366; }
        .logo { display: block; margin: 0 auto 20px; width: 180px; }
        .hidden { display: none; }
        .form-group { margin-bottom: 18px; }
        label { font-weight: bold; display: block; margin-bottom: 6px; }
        input, select { width: 100%; padding: 8px; }
        button { background: #003366; color: #fff; border: none; padding: 10px 20px; border-radius: 5px; font-size: 16px; cursor: pointer; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .category { background: #eef; margin-bottom: 20px; padding: 15px; border-radius: 6px; }
        .preview { background: #ffe; padding: 18px; border-radius: 8px; margin-bottom: 18px; }
        .success { color: green; font-weight: bold; text-align: center; padding: 15px; }
    </style>
</head>
<body>
    <div class="container">
        <img src="https://www.pasolini.it/wp-content/uploads/2020/04/logo-pasolini.png" class="logo" alt="PASOLINI Logo">
        <h1>PREVENTIVATORE AUTOMATICO<br>PROGETTO PROLUNGHE</h1>

        <!-- Login -->
        <div id="login-section">
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password">
            </div>
            <button onclick="checkLogin()">Accedi</button>
        </div>

        <!-- Dati cliente e scelta linea -->
        <div id="cliente-section" class="hidden">
            <div class="form-group">
                <label for="nome">Nome Cliente</label>
                <input type="text" id="nome">
            </div>
            <div class="form-group">
                <label for="azienda">Azienda</label>
                <input type="text" id="azienda">
            </div>
            <div class="form-group">
                <label for="linea">Seleziona Linea Prodotto</label>
                <select id="linea"></select>
            </div>
            <button onclick="startPreventivo()">Avanti</button>
        </div>

        <!-- Preventivazione per linea -->
        <div id="preventivo-section" class="hidden">
            <div id="prodotti-list"></div>
            <button onclick="aggiungiLinea()">Aggiungi un’altra linea prodotto</button>
            <button onclick="mostraAnteprima()">Concludi preventivo</button>
        </div>

        <!-- Anteprima preventivo -->
        <div id="anteprima-section" class="hidden">
            <div class="preview" id="riepilogo"></div>
            <div class="form-group">
                <label for="emailCliente">Inserisci la tua email</label>
                <input type="email" id="emailCliente" required>
            </div>
            <button onclick="inviaPreventivo()">Invia preventivo</button>
        </div>

        <!-- Messaggio conferma -->
        <div id="conferma-section" class="hidden">
            <div class="success">Preventivo inviato con successo. Grazie!</div>
        </div>
    </div>

    <script>
        // Password di accesso
        const PASSWORD = "PASOLINI2025";

        // Carica prodotti.json (simulato qui, in produzione fetch locale)
        const prodotti = {
            "linee": {
                "PROLUNGHE": {
                    "categorie": {
                        "RIPIANI DA 40": [
                            { "codice": "R40-80-G", "descrizione": "Ripiano 40x80", "colore": "Grigio", "prezzo": 12.5 },
                            { "codice": "R40-100-B", "descrizione": "Ripiano 40x100", "colore": "Bianco", "prezzo": 13.0 }
                        ],
                        "PROLUNGHE": [
                            { "codice": "PR40-G", "descrizione": "Prolunga 40", "colore": "Grigio", "prezzo": 5.0 }
                        ],
                        "SCHIENALI": [
                            { "codice": "S40-80-B", "descrizione": "Schienale 40x80", "colore": "Bianco", "prezzo": 6.5 }
                        ],
                        "MENSOLE": [
                            { "codice": "M40-100-G", "descrizione": "Mensola 40x100", "colore": "Grigio", "prezzo": 7.25 }
                        ],
                        "BARRE": [
                            { "codice": "B40-G", "descrizione": "Barra 40", "colore": "Grigio", "prezzo": 2.0 }
                        ],
                        "GANCI E PORTAPREZZO": [
                            { "codice": "G40", "descrizione": "Gancio 40", "colore": "", "prezzo": 1.5 }
                        ]
                    }
                }
                // ...altre linee
            }
        };

        // Variabili stato
        let preventivo = [];
        let currentLinea = null;

        // Login
        function checkLogin() {
            const pass = document.getElementById('password').value;
            if (pass === PASSWORD) {
                document.getElementById('login-section').classList.add('hidden');
                document.getElementById('cliente-section').classList.remove('hidden');
                popolaLinee();
            } else {
                alert('Password errata!');
            }
        }

        // Popola select linee prodotto
        function popolaLinee() {
            const lineaSel = document.getElementById('linea');
            lineaSel.innerHTML = '';
            Object.keys(prodotti.linee).forEach(linea => {
                const opt = document.createElement('option');
                opt.value = linea;
                opt.innerText = linea;
                lineaSel.appendChild(opt);
            });
        }

        // Avvio preventivo per linea selezionata
        function startPreventivo() {
            currentLinea = document.getElementById('linea').value;
            mostraProdottiLinea(currentLinea);
            document.getElementById('cliente-section').classList.add('hidden');
            document.getElementById('preventivo-section').classList.remove('hidden');
        }

        // Mostra prodotti per la linea selezionata
        function mostraProdottiLinea(linea) {
            const prodottiList = document.getElementById('prodotti-list');
            prodottiList.innerHTML = `<h3>${linea}</h3>`;
            Object.entries(prodotti.linee[linea].categorie).forEach(([categoria, prodottiCat]) => {
                const catDiv = document.createElement('div');
                catDiv.className = 'category';
                catDiv.innerHTML = `<strong>${categoria}</strong>`;
                prodottiCat.forEach(prodotto => {
                    catDiv.innerHTML += `
                        <div style="margin:8px 0">
                            <span>${prodotto.codice} - ${prodotto.descrizione} ${prodotto.colore ? '('+prodotto.colore+')' : ''}</span>
                            <span style="float:right">€${prodotto.prezzo.toFixed(2)}</span>
                            <br>
                            <input type="number" min="0" placeholder="Quantità" id="qty-${prodotto.codice}">
                        </div>
                    `;
                });
                prodottiList.appendChild(catDiv);
            });
        }

        // Aggiungi linea prodotto (conserva dati)
        function aggiungiLinea() {
            salvaQuantitaLinea();
            document.getElementById('preventivo-section').classList.add('hidden');
            document.getElementById('cliente-section').classList.remove('hidden');
        }

        // Salva quantità per la linea corrente
        function salvaQuantitaLinea() {
            const dati = { linea: currentLinea, prodotti: [] };
            Object.entries(prodotti.linee[currentLinea].categorie).forEach(([categoria, prodottiCat]) => {
                prodottiCat.forEach(prodotto => {
                    const qty = parseInt(document.getElementById(`qty-${prodotto.codice}`).value) || 0;
                    if(qty > 0) {
                        dati.prodotti.push({
                            ...prodotto,
                            categoria,
                            quantita: qty
                        });
                    }
                });
            });
            if (dati.prodotti.length > 0) preventivo.push(dati);
        }

        // Mostra anteprima preventivo
        function mostraAnteprima() {
            salvaQuantitaLinea();
            document.getElementById('preventivo-section').classList.add('hidden');
            document.getElementById('anteprima-section').classList.remove('hidden');
            popolaRiepilogo();
        }

        // Popola riepilogo preventivo
        function popolaRiepilogo() {
            // Raggruppa prodotti per codice
            const tutti = preventivo.flatMap(l => l.prodotti);
            const riepilogo = {};
            tutti.forEach(p => {
                if (!riepilogo[p.codice]) {
                    riepilogo[p.codice] = {...p, quantita: 0};
                }
                riepilogo[p.codice].quantita += p.quantita;
            });
            let html = `<h3>Riepilogo Preventivo</h3><table width="100%" border="0"><tr>
                <th>Codice</th><th>Descrizione</th><th>Categoria</th><th>Colore</th><th>Quantità Totale</th><th>Prezzo Unitario</th></tr>`;
            Object.values(riepilogo).forEach(p => {
                html += `<tr>
                    <td>${p.codice}</td>
                    <td>${p.descrizione}</td>
                    <td>${p.categoria}</td>
                    <td>${p.colore || '-'}</td>
                    <td>${p.quantita}</td>
                    <td>€${p.prezzo.toFixed(2)}</td>
                </tr>`;
            });
            html += '</table>';
            document.getElementById('riepilogo').innerHTML = html;
        }

        // Invia preventivo (simulazione invio PDF)
        function inviaPreventivo() {
            // In produzione: generazione PDF, invio via email
            // Qui: mostra conferma
            document.getElementById('anteprima-section').classList.add('hidden');
            document.getElementById('conferma-section').classList.remove('hidden');
        }
    </script>
</body>
</html>
