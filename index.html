<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>PREVENTIVATORE AUTOMATICO PROGETTO PROLUNGHE</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f7f7f7; }
        .container { max-width: 800px; margin: 40px auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 8px #bbb; padding: 30px; }
        h1 { text-align: center; color: #003366; }
        .logo { display: block; margin: 0 auto 20px; width: 180px; }
        .hidden { display: none; }
        .form-group { margin-bottom: 18px; }
        label { font-weight: bold; display: block; margin-bottom: 6px; }
        input[type="text"], input[type="email"], input[type="password"], textarea, select { width: 100%; padding: 8px; }
        button { background: #003366; color: #fff; border: none; padding: 10px 20px; border-radius: 5px; font-size: 16px; cursor: pointer; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .category { background: #eef; margin-bottom: 20px; padding: 15px; border-radius: 6px; }
        .product-item { display: flex; align-items: center; margin-bottom: 8px; }
        .product-details { flex-grow: 1; font-size: 0.8em; }
        .product-item input[type="number"] { width: 80px; margin-left: 10px; }
        .preview { background: #ffe; padding: 18px; border-radius: 8px; margin-bottom: 18px; font-size: 0.8em; }
        .success { color: green; font-weight: bold; text-align: center; padding: 15px; }
        .button-group { display: flex; justify-content: space-between; margin-top: 20px; }
        .preview table { width: 100%; border-collapse: collapse; }
        .preview table td, .preview table th { font-size: 0.9em; padding: 5px; border: 1px solid #ddd; }
        .preview table th.align-right, .preview table td.align-right { text-align: right; }
        .total-row { font-weight: bold; }
        .total-row td { border-top: 2px solid #000; }

        /* Stili per l'input della password e l'icona */
        .password-container {
            position: relative;
            width: 100%;
        }
        .password-container input {
            width: 100%;
            padding-right: 40px;
            box-sizing: border-box;
        }
        .toggle-password {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            user-select: none;
            font-size: 1.2em;
            color: #555;
        }

        /* Stili per il footer */
        .footer {
            margin-top: 30px;
            text-align: center;
            font-size: 0.75em;
            color: #888;
            display: none;
        }

        /* Stili specifici per la stampa */
        @media print {
            body { font-size: 12px; }
            .container { box-shadow: none; border: none; padding: 0; }
            button, .button-group, .email-info, #note-section, .password-container, h1, img.logo { display: none; }
            #anteprima-section { display: block !important; margin: 0; }
            .preview { background: none; }
            h2, h3, p { margin: 5px 0; }
            .footer {
                display: flex;
                align-items: center;
                justify-content: center;
                margin-top: 30px;
                font-size: 0.7em;
                color: #888;
                page-break-before: always;
            }
            .footer-logo {
                height: 20px;
                margin-right: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="LOGO PASOLINI CC.jpg" class="logo" alt="PASOLINI Logo">
        <h1>PREVENTIVATORE AUTOMATICO<br>PROGETTO PROLUNGHE</h1>

        <div id="login-section">
            <div class="form-group">
                <label for="password">Password</label>
                <div class="password-container">
                    <input type="password" id="passwordInput">
                    <span class="toggle-password" onclick="togglePasswordVisibility()">üëÅÔ∏è</span>
                </div>
            </div>
            <button onclick="checkLogin()">Accedi</button>
        </div>

        <div id="cliente-section" class="hidden">
            <div class="form-group">
                <label for="nomePuntoVendita">Nome Punto Vendita</label>
                <input type="text" id="nomePuntoVendita" required>
            </div>
            <div class="form-group">
                <label for="indirizzoPuntoVendita">Indirizzo Punto Vendita</label>
                <input type="text" id="indirizzoPuntoVendita" required>
            </div>
            <div class="form-group">
                <label for="fatturazione">Fatturazione</label>
                <input type="text" id="fatturazione" required>
            </div>
            <div class="form-group">
                <label for="linea">Seleziona Linea Prodotto</label>
                <select id="linea"></select>
            </div>
            <button onclick="startPreventivo()">Avanti</button>
        </div>

        <div id="preventivo-section" class="hidden">
            <div id="prodotti-list"></div>
            <div class="form-group" id="note-section">
                <label for="note">Note</label>
                <textarea id="note" rows="4" placeholder="Inserisci qui eventuali note o richieste speciali per il preventivo..."></textarea>
            </div>
            <div class="button-group">
                <button onclick="tornaAChoice()">Indietro</button>
                <div>
                    <button onclick="aggiungiLinea()">Aggiungi un‚Äôaltra linea prodotto</button>
                    <button onclick="mostraAnteprima()">Concludi preventivo</button>
                </div>
            </div>
        </div>

        <div id="anteprima-section" class="hidden">
            <div class="preview" id="riepilogo"></div>
            <div class="email-info">
                <p style="color: red; font-weight: bold; text-align: center;">ATTENZIONE: Il servizio di invio mail non √® ancora attivo. Dopo aver stampato il preventivo, si prega di inviarlo manualmente all'indirizzo del responsabile commerciale Pasolini.</p>
            </div>
            <div class="button-group">
                <button onclick="tornaAllaHome()">Torna alla Home</button>
                <button onclick="tornaAPreventivo()">Indietro</button>
                <div>
                    <button onclick="stampaPreventivo()">Stampa Preventivo</button>
                    <button onclick="concludiInvio()">Concludi</button>
                </div>
            </div>
        </div>

        <div id="conferma-section" class="hidden">
            <div class="success">Preventivo salvato e stampato. Si prega di inviarlo manualmente.</div>
            <button onclick="tornaAllaHome()">Nuovo preventivo</button>
        </div>
    </div>

    <div class="footer">
        <img src="logoico_grigio jpg.jpg" alt="I-Co Design Logo" class="footer-logo">
        <span>¬© I-Co Design di C. Carbini - Tutti i diritti riservati. Il presente preventivatore non raccoglie dati personali.</span>
    </div>

    <script>
        // Password di accesso
        const PASSWORD = "PASOLINI2025";
        const IVA_RATE = 0.22; // 22%

        // Database dei prodotti con i dati forniti
        const prodotti = {
            "linee": {
                "PASOLINI_MEP": {
                    "categorie": {
                        "RIPIANI DA 40": [
                            { "codice": "4320232/8", "descrizione": "RIPIANO LAMIERA 750X400 LISCIO VERNICIATO RAL 9010 BUCCIATO", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 18.24 },
                            { "codice": "4320432/8", "descrizione": "RIPIANO LAMIERA 750X400 FORATO VERNICIATO RAL 9010 BUCCIATO", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 14.68 },
                            { "codice": "4320234/8", "descrizione": "RIPIANO LAMIERA 1000X400 LISCIO VERNICIATO RAL 9010 BUCCIATO", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 24.80 },
                            { "codice": "4320434/8", "descrizione": "RIPIANO LAMIERA 1000X400 FORATO VERNICIATO RAL 9010 BUCCIATO", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 23.46 },
                            { "codice": "4320236/8", "descrizione": "RIPIANO LAMIERA 1330X400 LISCIO VERNICIATO RAL 9010 BUCCIATO", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 24.18 },
                            { "codice": "4320436/8", "descrizione": "RIPIANO LAMIERA 1330X400 FORATO VERNICIATO RAL 9010 BUCCIATO", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 19.47 }
                        ],
                        "PROLUNGHE": [
                            { "codice": "4200544", "descrizione": "PROLUNGA PER MONTANTE SAGOMATO 250x90 VERNICIATO  RAL 9010 BUCCIATO", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 15.15 },
                            { "codice": "5007780", "descrizione": "PROLUNGA PER MONTANTE SAGOMATO 250x45 VERNICIATO  RAL 9010 BUCCIATO", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 9.81 },
                            { "codice": "4200546", "descrizione": "PROLUNGA PER MONTANTE SAGOMATO 430x90 VERNICIATO  RAL 9010 BUCCIATO", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 20.45 },
                            { "codice": "5007782", "descrizione": "PROLUNGA PER MONTANTE SAGOMATO 430x45 VERNICIATO  RAL 9010 BUCCIATO", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 13.88 }
                        ],
                        "SCHIENALI": [
                            { "codice": "4280022", "descrizione": "SCHIENALE DA 750X250 MM VERNICIATO  RAL 9010 BUCCIATO", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 8.01 },
                            { "codice": "4280024", "descrizione": "SCHIENALE DA 1000X250 MM VERNICIATO  RAL 9010 BUCCIATO", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 8.64 },
                            { "codice": "4280032", "descrizione": "SCHIENALE DA 750X430 MM VERNICIATO  RAL 9010 BUCCIATO", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 9.05 },
                            { "codice": "4280034", "descrizione": "SCHIENALE DA 1000X430 MM VERNICIATO  RAL 9010 BUCCIATO", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 11.34 },
                            { "codice": "4280026", "descrizione": "SCHIENALE DA 1330X250 MM VERNICIATO  RAL 9010 BUCCIATO", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 10.18 },
                            { "codice": "4280036", "descrizione": "SCHIENALE DA 1330X430 MM VERNICIATO  RAL 9010 BUCCIATO", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 16.86 }
                        ],
                        "MENSOLE": [
                            { "codice": "4360026", "descrizione": "MENSOLA 400MM (FERRO) RAL 9010 BUCCIATO", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 4.23 }
                        ],
                        "BARRE": [
                            { "codice": "5007020", "descrizione": "BARRA 750mm", "colore": "CROMATE", "prezzo": 10.68 },
                            { "codice": "5007022", "descrizione": "BARRA 1000mm", "colore": "CROMATE", "prezzo": 12.90 },
                            { "codice": "5007024", "descrizione": "BARRA 1330mm", "colore": "CROMATE", "prezzo": 17.25 }
                        ],
                        "GANCI": [
                            { "codice": "5007010.1", "descrizione": "GANCIO DA 30cm Diam. 8 mm", "colore": "CROMATI", "prezzo": 2.71 },
                            { "codice": "5007026.1", "descrizione": "GANCIO DA 30cm Diam. 6 mm", "colore": "CROMATI", "prezzo": 2.62 }
                        ],
                        "PORTAPREZZI": [
                            { "codice": "DRA39.1102", "descrizione": "PORTA PREZZO HL PER GANCIO 7,5x3,9cm", "colore": "TRASPARENTE", "prezzo": 0.21 },
                            { "codice": "MPS.42.0742.BL", "descrizione": "PORTASCANNER 750mm BLU", "colore": "BLU", "prezzo": 1.91 },
                            { "codice": "MPS.42.0992.BL", "descrizione": "PORTASCANNER 1000mm BLU", "colore": "BLU", "prezzo": 2.44 },
                            { "codice": "MPS.42.1318.BL", "descrizione": "PORTASCANNER 1330mm BLU", "colore": "BLU", "prezzo": 2.71 }
                        ]
                    }
                },
                "INTRAC": {
                    "categorie": {
                        "RIPIANI DA 40": [
                            { "codice": "4320234/8.7035", "descrizione": "RIPIANO LAMIERA 1000X400 LISCIO VERNICIATO RAL 7035", "colore": "GRIGIO RAL 7035 OPACO", "prezzo": 25.86 },
                            { "codice": "4320236/8.7035", "descrizione": "RIPIANO LAMIERA 1330X400 LISCIO VERNICIATO RAL 7035", "colore": "GRIGIO RAL 7035 OPACO", "prezzo": 29.76 }
                        ],
                        "PROLUNGHE": [
                            { "codice": "AS2220E.70.250.750", "descrizione": "PROLUNGA PER MONTANTE SAGOMATO 250X75 VERNICIATO RAL 7035 OPACO (INTRAC)", "colore": "GRIGIO RAL 7035 OPACO", "prezzo": 40.40 },
                            { "codice": "AS2220E.250.7035", "descrizione": "PROLUNGA PER MONTANTE SAGOMATO 250X105 VERNICIATO RAL 7035 OPACO (INTRAC)", "colore": "GRIGIO RAL 7035 OPACO", "prezzo": 40.40 },
                            { "codice": "AS2220E.7035", "descrizione": "PROLUNGA PER MONTANTE SAGOMATO 400X105 VERNICIATO RAL 7035 OPACO (INTRAC)", "colore": "GRIGIO RAL 7035 OPACO", "prezzo": 45.12 }
                        ],
                        "SCHIENALI": [
                            { "codice": "AS1253E.25.1000.250.7035", "descrizione": "SCHIENALE DA 1000X250 MM VERNICIATO  RAL 7035 OPACO (INTRAC)", "colore": "GRIGIO RAL 7035 OPACO", "prezzo": 9.79 },
                            { "codice": "AS1253E.25.1330.250.7035", "descrizione": "SCHIENALE DA 1330X250 MM VERNICIATO  RAL 7035 OPACO (INTRAC)", "colore": "GRIGIO RAL 7035 OPACO", "prezzo": 11.20 },
                            { "codice": "AS1253E.25.1000.400.7035", "descrizione": "SCHIENALE DA 1000X400 MM VERNICIATO  RAL 7035 OPACO (INTRAC)", "colore": "GRIGIO RAL 7035 OPACO", "prezzo": 16.00 },
                            { "codice": "AS1253E.25.1330.400.7035", "descrizione": "SCHIENALE DA 1330X400 MM VERNICIATO  RAL 7035 OPACO (INTRAC)", "colore": "GRIGIO RAL 7035 OPACO", "prezzo": 17.10 }
                        ],
                        "MENSOLE": [
                            { "codice": "AS1252A.400.7035", "descrizione": "MENSOLA  DA 40 VERNICIATORAL 7035 OPACO", "colore": "GRIGIO RAL 7035 OPACO", "prezzo": 3.95 }
                        ],
                        "BARRE": [
                            { "codice": "5007022.M", "descrizione": "BARRA 1000mm compatibile SEVG/INTRAC/CEFLA", "colore": "CROMATE", "prezzo": 18.15 },
                            { "codice": "5007024.M", "descrizione": "BARRA 1330mm compatibile SEVG/INTRAC/CEFLA", "colore": "CROMATE", "prezzo": 20.57 }
                        ],
                        "GANCI": [
                            { "codice": "5007030", "descrizione": "GANCIO DA 30cm diam. 6 MM mod. INTRAC", "colore": "CROMATI", "prezzo": 2.71 }
                        ],
                        "PORTAPREZZI": [
                            { "codice": "DRA39.1102", "descrizione": "PORTA PREZZO HL PER GANCIO 7,5x3,9cm", "colore": "TRASPARENTE", "prezzo": 0.21 },
                            { "codice": "MPS.42.0742.BL", "descrizione": "PORTASCANNER 750mm BLU", "colore": "BLU", "prezzo": 1.91 },
                            { "codice": "MPS.42.0992.BL", "descrizione": "PORTASCANNER 1000mm BLU", "colore": "BLU", "prezzo": 2.44 },
                            { "codice": "MPS.42.1318.BL", "colore": "BLU", "prezzo": 2.71 }
                        ]
                    }
                },
                "CEFLA": {
                    "categorie": {
                        "RIPIANI DA 40": [
                            { "codice": "4320430/8.9010", "descrizione": "RIPIANI FORATO NON BUCCIATO 665mmX400mm BIANCO", "colore": "BIANCO RAL 9010", "prezzo": 23.00 },
                            { "codice": "4320430/8.7024", "descrizione": "RIPIANI FORATO NON BUCCIATO 665 mmX400 mm ANTRACITE", "colore": "ANTRACITE RAL 7024", "prezzo": 23.00 },
                            { "codice": "4320434/8.9010", "descrizione": "RIPIANI FORATO NON BUCCIATO 1000mmX400 cm BIANCO", "colore": "BIANCO RAL 9010", "prezzo": 23.00 },
                            { "codice": "4320434/8.7024", "descrizione": "RIPIANI FORATO NON BUCCIATO 1000 mmX400 mm ANTRACITE", "colore": "ANTRACITE RAL 7024", "prezzo": 23.00 },
                            { "codice": "4320436/8.9010", "descrizione": "RIPIANI FORATO NON BUCCIATO 1330mmX400 cm BIANCO", "colore": "BIANCO RAL 9010", "prezzo": 32.00 },
                            { "codice": "4320436/8.7024", "descrizione": "RIPIANI FORATO NON BUCCIATO 1330mmX400 cm ANTRACITE", "colore": "ANTRACITE RAL 7024", "prezzo": 32.00 },
                            { "codice": "4320230/8.9010", "descrizione": "RIPIANI LISCIO NON BUCCIATO 665 mmX400mm BIANCO", "colore": "BIANCO RAL 9010", "prezzo": 18.00 },
                            { "codice": "4320230/8.7024", "descrizione": "RIPIANI LISCIO NON BUCCIATO 665 mmX400 mm ANTRACITE", "colore": "ANTRACITE RAL 7024", "prezzo": 18.00 },
                            { "codice": "4320234/8.9010", "descrizione": "RIPIANI LISCIO NON BUCCIATO 1000mmX400 cm BIANCO", "colore": "BIANCO RAL 9010", "prezzo": 23.51 },
                            { "codice": "4320234/8.7024", "descrizione": "RIPIANI LISCIO NON BUCCIATO 1000mmX400 cm ANTRACITE", "colore": "ANTRACITE RAL 7024", "prezzo": 23.51 },
                            { "codice": "4320236/8.9010", "descrizione": "RIPIANI LISCIO NON BUCCIATO 1330mmX400 cm BIANCO", "colore": "BIANCO RAL 9010", "prezzo": 27.05 },
                            { "codice": "4320236/8.7024", "descrizione": "RIPIANI LISCIO NON BUCCIATO 1330mmX400 cm ANTRACITE", "colore": "ANTRACITE RAL 7024", "prezzo": 27.05 }
                        ],
                        "PROLUNGHE": [
                            { "codice": "AS2220D.250.9010", "descrizione": "PROLUNGA 9X250MM BIANCA", "colore": "BIANCO RAL 9010", "prezzo": 36.73 },
                            { "codice": "AS2220D.250.7024", "descrizione": "PROLUNGA 9X250MM ANTRACITE", "colore": "ANTRACITE RAL 7024", "prezzo": 36.73 },
                            { "codice": "AS2220D.9010", "descrizione": "PROLUNGA 9X400MM BIANCA", "colore": "BIANCO RAL 9010", "prezzo": 41.02 },
                            { "codice": "AS2220D.7024", "descrizione": "PROLUNGA 9X400MM ANTRACITE", "colore": "ANTRACITE RAL 7024", "prezzo": 41.02 }
                        ],
                        "SCHIENALI": [
                            { "codice": "AS1253D.25.665.250.9010", "descrizione": "SCHIENALE 660X250MM", "colore": "BIANCO RAL 9010", "prezzo": 10.00 },
                            { "codice": "AS1253D.25.665.250.7024", "descrizione": "SCHIENALE 660X250MM", "colore": "ANTRACITE RAL 7024", "prezzo": 10.00 },
                            { "codice": "AS1253D.25.665.400.9010", "descrizione": "SCHIENALE 665X400MM", "colore": "BIANCO RAL 9010", "prezzo": 13.00 },
                            { "codice": "AS1253D.25.665.400.7024", "descrizione": "SCHIENALE 665X400MM", "colore": "ANTRACITE RAL 7024", "prezzo": 13.00 },
                            { "codice": "AS1253D.25.1000.250.9010", "descrizione": "SCHIENALE 1000X250MM", "colore": "BIANCO RAL 9010", "prezzo": 13.00 },
                            { "codice": "AS1253D.25.1000.250.7024", "descrizione": "SCHIENALE 1000X250MM", "colore": "ANTRACITE RAL 7024", "prezzo": 13.00 },
                            { "codice": "AS1253D.25.1000.400.9010", "descrizione": "SCHIENALE 1000X400MM", "colore": "BIANCO RAL 9010", "prezzo": 14.63 },
                            { "codice": "AS1253D.25.1000.400.7024", "descrizione": "SCHIENALE 1000X400MM", "colore": "ANTRACITE RAL 7024", "prezzo": 14.63 },
                            { "codice": "AS1253D.25.1330.250.9010", "descrizione": "SCHIENALE 1330X250MM", "colore": "BIANCO RAL 9010", "prezzo": 15.00 },
                            { "codice": "AS1253D.25.1330.250.7024", "descrizione": "SCHIENALE 1330X250MM", "colore": "ANTRACITE RAL 7024", "prezzo": 15.00 },
                            { "codice": "AS1253D.25.1330.400.9010", "descrizione": "SCHIENALE 1330X400MM", "colore": "BIANCO RAL 9010", "prezzo": 16.00 },
                            { "codice": "AS1253D.25.1330.400.7024", "descrizione": "SCHIENALE 1330X400MM", "colore": "ANTRACITE RAL 7024", "prezzo": 16.00 }
                        ],
                        "MENSOLE": [
                            { "codice": "AS1252D.400.9010", "descrizione": "MENSOLA  400mm BIANCA", "colore": "BIANCO RAL 9010", "prezzo": 5.00 },
                            { "codice": "AS1252D.400.7024", "descrizione": "MENSOLA  400mm ANTRACITE", "colore": "ANTRACITE RAL 7024", "prezzo": 5.00 }
                        ],
                        "BARRE": [
                            { "codice": "5007022.M", "descrizione": "BARRA 1000mm compatibile SEVG/INTRAC/CEFLA", "colore": "CROMATE", "prezzo": 18.15 },
                            { "codice": "5007024.M", "descrizione": "BARRA 1330mm compatibile SEVG/INTRAC/CEFLA", "colore": "CROMATE", "prezzo": 20.57 }
                        ],
                        "GANCI": [
                            { "codice": "5007030", "descrizione": "GANCIO DA 30cm diam. 6 MM mod. INTRAC", "colore": "CROMATI", "prezzo": 2.71 }
                        ],
                        "PORTAPREZZI": [
                            { "codice": "DRA39.1102", "descrizione": "PORTA PREZZO HL PER GANCIO 7,5x3,9cm", "colore": "TRASPARENTE", "prezzo": 0.21 },
                            { "codice": "MPS.42.0742.BL", "descrizione": "PORTASCANNER 750mm BLU", "colore": "BLU", "prezzo": 1.91 },
                            { "codice": "MPS.42.0992.BL", "descrizione": "PORTASCANNER 1000mm BLU", "colore": "BLU", "prezzo": 2.44 },
                            { "codice": "MPS.42.1318.BL", "colore": "BLU", "prezzo": 2.71 }
                        ]
                    }
                },
                "SEV_G": {
                    "categorie": {
                        "RIPIANI DA 40": [
                            { "codice": "4320234/8.7035", "descrizione": "RIPIANO LAMIERA 1000X400 LISCIO VERNICIATO RAL 7035", "colore": "GRIGIO RAL 7035 OPACO", "prezzo": 25.86 },
                            { "codice": "4320236/8.7035", "descrizione": "RIPIANO LAMIERA 1330X400 LISCIO VERNICIATO RAL 7035", "colore": "GRIGIO RAL 7035 OPACO", "prezzo": 29.76 }
                        ],
                        "PROLUNGHE": [
                            { "codice": "AS2220A.75.250.7035", "descrizione": "PROLUNGA PER MONTANTE SAGOMATO 250X75 VERNICIATO RAL 7035 OPACO (SEV G)", "colore": "GRIGIO RAL 7035 OPACO", "prezzo": 40.40 },
                            { "codice": "AS2220A.250.7035", "descrizione": "PROLUNGA PER MONTANTE SAGOMATO 250X105 VERNICIATO RAL 7035 OPACO (SEV G)", "colore": "GRIGIO RAL 7035 OPACO", "prezzo": 40.40 },
                            { "codice": "AS2220A.75.7035", "descrizione": "PROLUNGA PER MONTANTE SAGOMATO 400X75 VERNICIATO RAL 7035 OPACO (SEV G)", "colore": "GRIGIO RAL 7035 OPACO", "prezzo": 45.12 },
                            { "codice": "AS2220A.7035", "descrizione": "PROLUNGA PER MONTANTE SAGOMATO 400X105 VERNICIATO RAL 7035 OPACO (SEV G)", "colore": "GRIGIO RAL 7035 OPACO", "prezzo": 45.12 }
                        ],
                        "SCHIENALI": [
                            { "codice": "AS1253A.25.1000.250.7035", "descrizione": "SCHIENALE DA 1000X250 MM VERNICIATO  RAL 7035 OPACO (SEV G)", "colore": "GRIGIO RAL 7035 OPACO", "prezzo": 13.00 },
                            { "codice": "AS1253A.25.1330.250.7035", "descrizione": "SCHIENALE DA 1330X250 MM VERNICIATO  RAL 7035 OPACO (SEV G)", "colore": "GRIGIO RAL 7035 OPACO", "prezzo": 14.00 },
                            { "codice": "AS1253A.25.1000.400.7035", "descrizione": "SCHIENALE DA 1000X400 MM VERNICIATO  RAL 7035 OPACO (SEV G)", "colore": "GRIGIO RAL 7035 OPACO", "prezzo": 16.00 },
                            { "codice": "AS1253A.25.1330.400.7035", "descrizione": "SCHIENALE DA 1330X400 MM VERNICIATO  RAL 7035 OPACO (SEV G)", "colore": "GRIGIO RAL 7035 OPACO", "prezzo": 17.10 }
                        ],
                        "MENSOLE": [
                            { "codice": "AS1252A.400.7035", "descrizione": "MENSOLA  DA 40 VERNICIATORAL 7035 OPACO", "colore": "GRIGIO RAL 7035 OPACO", "prezzo": 3.95 }
                        ],
                        "BARRE": [
                            { "codice": "5007022.M", "descrizione": "BARRA 1000mm compatibile SEVG/INTRAC/CEFLA", "colore": "CROMATE", "prezzo": 18.15 },
                            { "codice": "5007024.M", "descrizione": "BARRA 1330mm compatibile SEVG/INTRAC/CEFLA", "colore": "CROMATE", "prezzo": 20.57 }
                        ],
                        "GANCI": [
                            { "codice": "5007030", "descrizione": "GANCIO DA 30cm diam. 6 MM mod. INTRAC", "colore": "CROMATI", "prezzo": 2.71 }
                        ],
                        "PORTAPREZZI": [
                            { "codice": "DRA39.1102", "descrizione": "PORTA PREZZO HL PER GANCIO 7,5x3,9cm", "colore": "TRASPARENTE", "prezzo": 0.21 },
                            { "codice": "MPS.42.0742.BL", "descrizione": "PORTASCANNER 750mm BLU", "colore": "BLU", "prezzo": 1.91 },
                            { "codice": "MPS.42.0992.BL", "colore": "BLU", "prezzo": 2.44 },
                            { "codice": "MPS.42.1318.BL", "descrizione": "PORTASCANNER 1330mm BLU", "colore": "BLU", "prezzo": 2.71 }
                        ]
                    }
                },
                "SEV_B": {
                    "categorie": {
                        "RIPIANI DA 40": [
                            { "codice": "4320232/8", "descrizione": "RIPIANO LAMIERA 750X400 LISCIO VERNICIATO RAL 9010 BUCCIATO AXALTA", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 18.24 },
                            { "codice": "4320432/8", "descrizione": "RIPIANO LAMIERA 750X400 FORATO VERNICIATO RAL 9010 BUCCIATO AXALTA", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 14.68 },
                            { "codice": "4320234/8", "descrizione": "RIPIANO LAMIERA 1000X400 LISCIO VERNICIATO RAL 9010 BUCCIATO AXALTA", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 24.80 },
                            { "codice": "4320434/8", "descrizione": "RIPIANO LAMIERA 1000X400 FORATO VERNICIATO RAL 9010 BUCCIATO AXALTA", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 23.46 },
                            { "codice": "4320236/8", "descrizione": "RIPIANO LAMIERA 1330X400 LISCIO VERNICIATO RAL 9010 BUCCIATO AXALTA", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 24.18 },
                            { "codice": "4320436/8", "descrizione": "RIPIANO LAMIERA 1330X400 FORATO VERNICIATO RAL 9010 BUCCIATO AXALTA", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 19.47 }
                        ],
                        "PROLUNGHE": [
                            { "codice": "AS2220C.240", "descrizione": "PROLUNGA PER MONTANTE SAGOMATO 240X105 VERNICIATO  RAL 9010 BUCCIATO AXALTA", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 40.40 },
                            { "codice": "AS2220C", "descrizione": "PROLUNGA PER MONTANTE SAGOMATO 400X105 VERNICIATO  RAL 9010 BUCCIATO AXALTA", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 45.12 }
                        ],
                        "SCHIENALI": [
                            { "codice": "AS1253C.40.750.240", "descrizione": "SCHIENALE DA 750X240 MM VERNICIATO  RAL 9010 BUCCIATO AXALTA", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 26.40 },
                            { "codice": "AS1253C.40.1000.240", "descrizione": "SCHIENALE DA 1000X240 MM VERNICIATO  RAL 9010 BUCCIATO AXALTA", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 9.47 },
                            { "codice": "AS1253C.40.1330.240", "descrizione": "SCHIENALE DA 1330X240 MM VERNICIATO  RAL 9010 BUCCIATO AXALTA", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 11.20 },
                            { "codice": "AS1253C.40.750.400", "descrizione": "SCHIENALE DA 750X400 MM VERNICIATO  RAL 9010 BUCCIATO AXALTA", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 13.00 },
                            { "codice": "AS1253C.40.1000.400", "descrizione": "SCHIENALE DA 1000X400 MM VERNICIATO  RAL 9010 BUCCIATO AXALTA", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 14.63 },
                            { "codice": "AS1253C.40.1330.400", "descrizione": "SCHIENALE DA 1330X400 MM VERNICIATO  RAL 9010 BUCCIATO AXALTA", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 16.00 }
                        ],
                        "MENSOLE": [
                            { "codice": "AS1252C.400", "descrizione": "MENSOLA  400mm VERNICIATA RAL 9010 BUCCIATO AXALTA", "colore": "BIANCO RAL 9010 BUCCIATO", "prezzo": 5.00 }
                        ],
                        "BARRE": [
                            { "codice": "5007022.M", "descrizione": "BARRA 1000mm compatibile SEVG/INTRAC/CEFLA", "colore": "CROMATE", "prezzo": 18.15 },
                            { "codice": "5007024.M", "descrizione": "BARRA 1330mm compatibile SEVG/INTRAC/CEFLA", "colore": "CROMATE", "prezzo": 20.57 }
                        ],
                        "GANCI": [
                            { "codice": "5007030", "descrizione": "GANCIO DA 30cm diam. 6 MM mod. INTRAC", "colore": "CROMATI", "prezzo": 2.71 }
                        ],
                        "PORTAPREZZI": [
                            { "codice": "DRA39.1102", "descrizione": "PORTA PREZZO HL PER GANCIO 7,5x3,9cm", "colore": "TRASPARENTE", "prezzo": 0.21 },
                            { "codice": "MPS.42.0742.BL", "descrizione": "PORTASCANNER 750mm BLU", "colore": "BLU", "prezzo": 1.91 },
                            { "codice": "MPS.42.0992.BL", "descrizione": "PORTASCANNER 1000mm BLU", "colore": "BLU", "prezzo": 2.44 },
                            { "codice": "MPS.42.1318.BL", "colore": "BLU", "prezzo": 2.71 }
                        ]
                    }
                },
                "FORTEZZA": {
                    "categorie": {
                        "RIPIANI DA 40": [
                            { "codice": "4320434/8.7035", "descrizione": "RIPIANI FORATO NON BUCCIATO 1000 mmX400 mm RAL 7035", "colore": "GRIGIO RAL7035", "prezzo": 23.00 },
                            { "codice": "4320436/8.7035", "descrizione": "RIPIANI FORATO NON BUCCIATO 1330mmX400 cm RAL 7035", "colore": "GRIGIO RAL7035", "prezzo": 32.00 },
                            { "codice": "4320234/8.7035", "descrizione": "RIPIANI LISCIO NON BUCCIATO 1000mmX400 cm RAL 7035", "colore": "GRIGIO RAL7035", "prezzo": 23.51 },
                            { "codice": "4320236/8.7035", "descrizione": "RIPIANI LISCIO NON BUCCIATO 1330mmX400 cm RAL 7035", "colore": "GRIGIO RAL7035", "prezzo": 27.05 }
                        ],
                        "PROLUNGHE": [
                            { "codice": "AS2220D.250.7035", "descrizione": "PROLUNGA 9X250MM RAL 7035", "colore": "GRIGIO RAL7035", "prezzo": 36.73 },
                            { "codice": "AS2220D.7035", "descrizione": "PROLUNGA 9X400MM RAL 7035", "colore": "GRIGIO RAL7035", "prezzo": 41.02 }
                        ],
                        "SCHIENALI": [
                            { "codice": "AS1253D.25.1000.250.7035", "descrizione": "SCHIENALE 1000X250MM RAL 7035", "colore": "GRIGIO RAL7035", "prezzo": 13.00 },
                            { "codice": "AS1253D.25.1330.250.7035", "descrizione": "SCHIENALE 1330X250MM RAL 7035", "colore": "GRIGIO RAL7035", "prezzo": 15.00 },
                            { "codice": "AS1253D.25.1000.400.7035", "descrizione": "SCHIENALE 1000X400MM RAL 7035", "colore": "GRIGIO RAL7035", "prezzo": 14.63 },
                            { "codice": "AS1253D.25.1330.400.7035", "descrizione": "SCHIENALE 1330X400MM RAL 7035", "colore": "GRIGIO RAL7035", "prezzo": 16.00 }
                        ],
                        "MENSOLE": [
                            { "codice": "AS1252D.400.7035", "descrizione": "MENSOLA  400mm RAL 7035", "colore": "GRIGIO RAL7035", "prezzo": 5.00 }
                        ],
                        "BARRE": [
                            { "codice": "5007022.M", "descrizione": "BARRA 1000mm compatibile SEVG/INTRAC/CEFLA", "colore": "CROMATE", "prezzo": 18.15 },
                            { "codice": "5007024.M", "descrizione": "BARRA 1330mm compatibile SEVG/INTRAC/CEFLA", "colore": "CROMATE", "prezzo": 20.57 }
                        ],
                        "GANCI": [
                            { "codice": "5007030", "descrizione": "GANCIO DA 30cm diam. 6 MM mod. INTRAC", "colore": "CROMATI", "prezzo": 2.71 }
                        ],
                        "PORTAPREZZI": [
                            { "codice": "DRA39.1102", "descrizione": "PORTA PREZZO HL PER GANCIO 7,5x3,9cm", "colore": "TRASPARENTE", "prezzo": 0.21 },
                            { "codice": "MPS.42.0742.BL", "descrizione": "PORTASCANNER 750mm BLU", "colore": "BLU", "prezzo": 1.91 },
                            { "codice": "MPS.42.0992.BL", "descrizione": "PORTASCANNER 1000mm BLU", "colore": "BLU", "prezzo": 2.44 },
                            { "codice": "MPS.42.1318.BL", "colore": "BLU", "prezzo": 2.71 }
                        ]
                    }
                }
            }
        };

        let preventivo = {};
        let lineeSelezionate = [];
        let lineaCorrente = null;

        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('passwordInput');
            const toggleIcon = document.querySelector('.toggle-password');
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.textContent = 'üôà';
            } else {
                passwordInput.type = 'password';
                toggleIcon.textContent = 'üëÅÔ∏è';
            }
        }

        function checkLogin() {
            const password = document.getElementById('passwordInput').value;
            if (password === PASSWORD) {
                document.getElementById('login-section').classList.add('hidden');
                document.getElementById('cliente-section').classList.remove('hidden');
                populateLinee();
            } else {
                alert("Password errata. Riprova.");
            }
        }

        function populateLinee() {
            const lineaSelect = document.getElementById('linea');
            lineaSelect.innerHTML = '<option value="">Seleziona una linea...</option>';
            for (const key in prodotti.linee) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = key.replace(/_/g, ' '); // Formatta il nome della linea
                lineaSelect.appendChild(option);
            }
        }

        function startPreventivo() {
            const nomePuntoVendita = document.getElementById('nomePuntoVendita').value;
            const indirizzoPuntoVendita = document.getElementById('indirizzoPuntoVendita').value;
            const fatturazione = document.getElementById('fatturazione').value;
            const linea = document.getElementById('linea').value;

            if (nomePuntoVendita && indirizzoPuntoVendita && fatturazione && linea) {
                preventivo.cliente = { nomePuntoVendita, indirizzoPuntoVendita, fatturazione };
                preventivo.linee = {};
                lineeSelezionate = [linea];
                lineaCorrente = linea;

                document.getElementById('cliente-section').classList.add('hidden');
                document.getElementById('preventivo-section').classList.remove('hidden');
                generateProductList(linea);
            } else {
                alert("Compila tutti i campi per procedere.");
            }
        }

        function generateProductList(linea) {
            const prodottiList = document.getElementById('prodotti-list');
            prodottiList.innerHTML = `<h2>Preventivo per la linea: ${linea.replace(/_/g, ' ')}</h2>`;
            const categorie = prodotti.linee[linea].categorie;

            preventivo.linee[linea] = {};

            for (const categoria in categorie) {
                const categoriaDiv = document.createElement('div');
                categoriaDiv.className = 'category';
                categoriaDiv.innerHTML = `<h3>${categoria}</h3>`;

                preventivo.linee[linea][categoria] = [];

                categorie[categoria].forEach((prodotto, index) => {
                    const productItemDiv = document.createElement('div');
                    productItemDiv.className = 'product-item';
                    productItemDiv.innerHTML = `
                        <div class="product-details">
                            <strong>${prodotto.codice}</strong> - ${prodotto.descrizione} (${prodotto.colore})
                        </div>
                        <input type="number" id="quantita-${linea}-${categoria}-${index}" min="0" value="0">
                    `;
                    categoriaDiv.appendChild(productItemDiv);
                });
                prodottiList.appendChild(categoriaDiv);
            }
        }

        function aggiungiLinea() {
            const prodottiList = document.getElementById('prodotti-list');
            const nuovaLinea = document.createElement('div');
            nuovaLinea.className = 'form-group';
            nuovaLinea.innerHTML = `
                <label for="nuovaLineaSelect">Aggiungi un'altra Linea Prodotto</label>
                <select id="nuovaLineaSelect"></select>
                <button onclick="selezionaNuovaLinea()">Aggiungi</button>
            `;
            prodottiList.appendChild(nuovaLinea);
            
            const nuovaLineaSelect = document.getElementById('nuovaLineaSelect');
            nuovaLineaSelect.innerHTML = '<option value="">Seleziona una linea...</option>';
            for (const key in prodotti.linee) {
                if (!lineeSelezionate.includes(key)) {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = key.replace(/_/g, ' ');
                    nuovaLineaSelect.appendChild(option);
                }
            }
        }

        function selezionaNuovaLinea() {
            const nuovaLinea = document.getElementById('nuovaLineaSelect').value;
            if (nuovaLinea && !lineeSelezionate.includes(nuovaLinea)) {
                lineeSelezionate.push(nuovaLinea);
                lineaCorrente = nuovaLinea;
                generateProductList(nuovaLinea);
                // Rimuove il selettore di "Aggiungi linea" per evitarne di aggiungerne troppi
                document.getElementById('prodotti-list').lastChild.remove();
            } else {
                alert("Seleziona una linea valida.");
            }
        }

        function calcolaTotale() {
            let totale = 0;
            for (const linea in preventivo.linee) {
                for (const categoria in preventivo.linee[linea]) {
                    preventivo.linee[linea][categoria].forEach(prodotto => {
                        totale += prodotto.quantita * prodotto.prezzo;
                    });
                }
            }
            return totale;
        }

        function mostraAnteprima() {
            const riepilogo = document.getElementById('riepilogo');
            riepilogo.innerHTML = '';

            const nomePuntoVendita = document.getElementById('nomePuntoVendita').value;
            const indirizzoPuntoVendita = document.getElementById('indirizzoPuntoVendita').value;
            const fatturazione = document.getElementById('fatturazione').value;
            const note = document.getElementById('note').value;

            // Raccolta dei dati dai campi di input
            lineeSelezionate.forEach(linea => {
                const categorie = prodotti.linee[linea].categorie;
                for (const categoria in categorie) {
                    categorie[categoria].forEach((prodotto, index) => {
                        const inputId = `quantita-${linea}-${categoria}-${index}`;
                        const quantita = parseInt(document.getElementById(inputId).value) || 0;
                        if (quantita > 0) {
                            if (!preventivo.linee[linea][categoria]) {
                                preventivo.linee[linea][categoria] = [];
                            }
                            preventivo.linee[linea][categoria].push({
                                ...prodotto,
                                quantita: quantita
                            });
                        }
                    });
                }
            });

            let totalePreventivo = 0;

            let riepilogoHTML = `
                <h2>Preventivo</h2>
                <p><strong>Nome Punto Vendita:</strong> ${nomePuntoVendita}</p>
                <p><strong>Indirizzo:</strong> ${indirizzoPuntoVendita}</p>
                <p><strong>Fatturazione:</strong> ${fatturazione}</p>
            `;

            if (note) {
                riepilogoHTML += `<p><strong>Note:</strong> ${note}</p>`;
            }
            
            lineeSelezionate.forEach(linea => {
                riepilogoHTML += `<h3>Linea Prodotto: ${linea.replace(/_/g, ' ')}</h3>`;
                let totaleLinea = 0;

                for (const categoria in preventivo.linee[linea]) {
                    const prodottiCategoria = preventivo.linee[linea][categoria];
                    if (prodottiCategoria.length > 0) {
                        riepilogoHTML += `<h4>${categoria}</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>Codice</th>
                                    <th>Descrizione</th>
                                    <th>Quantit√†</th>
                                    <th>Prezzo Unitario</th>
                                    <th class="align-right">Totale</th>
                                </tr>
                            </thead>
                            <tbody>
                        `;
                        prodottiCategoria.forEach(prodotto => {
                            const subtotale = prodotto.quantita * prodotto.prezzo;
                            totaleLinea += subtotale;
                            riepilogoHTML += `
                                <tr>
                                    <td>${prodotto.codice}</td>
                                    <td>${prodotto.descrizione} (${prodotto.colore})</td>
                                    <td>${prodotto.quantita}</td>
                                    <td>‚Ç¨ ${prodotto.prezzo.toFixed(2)}</td>
                                    <td class="align-right">‚Ç¨ ${subtotale.toFixed(2)}</td>
                                </tr>
                            `;
                        });
                        riepilogoHTML += `</tbody></table><br>`;
                    }
                }

                riepilogoHTML += `
                    <p style="text-align: right; font-weight: bold;">Totale Linea ${linea.replace(/_/g, ' ')}: ‚Ç¨ ${totaleLinea.toFixed(2)}</p>
                `;
                totalePreventivo += totaleLinea;
            });

            const iva = totalePreventivo * IVA_RATE;
            const totaleConIva = totalePreventivo + iva;

            riepilogoHTML += `
                <br>
                <p style="text-align: right;"><strong>Totale (IVA esclusa):</strong> ‚Ç¨ ${totalePreventivo.toFixed(2)}</p>
                <p style="text-align: right;"><strong>IVA (${(IVA_RATE * 100).toFixed(0)}%):</strong> ‚Ç¨ ${iva.toFixed(2)}</p>
                <p style="text-align: right; font-weight: bold; font-size: 1.2em; color: #003366;">Totale (IVA inclusa): ‚Ç¨ ${totaleConIva.toFixed(2)}</p>
            `;

            riepilogo.innerHTML = riepilogoHTML;
            document.getElementById('preventivo-section').classList.add('hidden');
            document.getElementById('anteprima-section').classList.remove('hidden');
        }

        function stampaPreventivo() {
            window.print();
        }

        function tornaAllaHome() {
            window.location.reload();
        }

        function tornaAPreventivo() {
            document.getElementById('anteprima-section').classList.add('hidden');
            document.getElementById('preventivo-section').classList.remove('hidden');
        }

        function tornaAChoice() {
            document.getElementById('preventivo-section').classList.add('hidden');
            document.getElementById('cliente-section').classList.remove('hidden');
            preventivo = {};
            lineeSelezionate = [];
            lineaCorrente = null;
        }

        function concludiInvio() {
            stampaPreventivo();
            document.getElementById('anteprima-section').classList.add('hidden');
            document.getElementById('conferma-section').classList.remove('hidden');
        }

        // Inizializzazione
        window.onload = () => {
            const now = new Date();
            const today = now.toLocaleDateString();
            document.title = `Preventivo Pasolini - ${today}`;
            populateLinee();
        };

    </script>
</body>
</html>
